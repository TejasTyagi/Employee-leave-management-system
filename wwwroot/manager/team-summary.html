<!-- Tejas Tyagi -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Team Leave Summary</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">Manager - Team Leave Summary</span>
        </div>
    </nav>

    <div class="container">
        <div class="mb-3">
            <label for="apiUrl" class="form-label">API Base URL</label>
            <input type="text" id="apiUrl" class="form-control"
                   value="https://localhost:5001/api/manager">
            <div class="form-text">
                Change the port to match your running Web API (from Swagger).
            </div>
        </div>

        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <label for="managerId" class="form-label">Manager Id</label>
                <input type="number" id="managerId" class="form-control" value="101">
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button class="btn btn-primary w-100" onclick="loadTeamLeaves()">Load Team Leaves</button>
            </div>
        </div>

        <div id="message" class="mb-3"></div>

        <table class="table table-striped" id="teamTable">
            <thead class="table-dark">
                <tr>
                    <th>Request Id</th>
                    <th>Employee Id</th>
                    <th>Manager Id</th>
                    <th>Type</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <script>
        function getBaseUrl() {
            return document.getElementById("apiUrl").value;
        }

        function showMessage(text, isError) {
            var div = document.getElementById("message");
            if (!text) {
                div.innerHTML = "";
                return;
            }
            var cls = isError ? "alert alert-danger" : "alert alert-info";
            div.className = cls;
            div.innerText = text;
        }

        function loadTeamLeaves() {
            showMessage("", false);

            var managerId = document.getElementById("managerId").value;
            if (!managerId) {
                showMessage("Please enter a manager id.", true);
                return;
            }

            var url = getBaseUrl() + "/teamleaves/" + managerId;

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Error loading team leave summary");
                    }
                    return response.json();
                })
                .then(data => {
                    var tbody = document.querySelector("#teamTable tbody");
                    tbody.innerHTML = "";

                    if (!data || data.length === 0) {
                        showMessage("No leave records found for this manager.", false);
                        return;
                    }

                    data.forEach(function (req) {
                        var row = document.createElement("tr");

                        row.innerHTML =
                            "<td>" + req.id + "</td>" +
                            "<td>" + req.employeeId + "</td>" +
                            "<td>" + req.managerId + "</td>" +
                            "<td>" + (req.leaveType || "") + "</td>" +
                            "<td>" + (req.startDate || "") + "</td>" +
                            "<td>" + (req.endDate || "") + "</td>" +
                            "<td>" + (req.status || "") + "</td>";

                        tbody.appendChild(row);
                    });
                })
                .catch(error => {
                    showMessage(error.message, true);
                });
        }
    </script>
</body>
</html>
